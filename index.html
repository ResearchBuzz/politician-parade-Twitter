<html>
<head><title>Search Congressional Representatives In TwitterSpace</title></head>
<body>

<h2>Search Congressional Representatives In TwitterSpace</h2>

<h3>
  Enter the Twitter query you want to do and the state you're interested in. This tool will generate a search of that state's congressional representative Twitter space.  </h3>
  
   <label>Query:</label>
  <input type="text" class="searchq" value="Medicare"><br><br>

  <label>State: (Please use two-letter postal code)</label>
  <input type="text" class="state" size="2" maxlength="2" value="IA"><br><br>

  <label>ProPublica API Key</label><br><br>
  <i>You'll need an API Key to use this tool. You can get them free from https://www.propublica.org/datastore/api/propublica-congress-api .</i><br><br>
  <input type="text" class="apikey" value="please paste your key here"><br><br>

<button onclick="Parade()">Parade them Politicians!</button><br><br>

<div id="Bpol"> 

</div>

<div id="Dpol"> 

</div>

<div id="Rpol"> 

</div>


<script>

function Parade(){

    // Getting values from form 

    var searchq = document.querySelector(".searchq").value
    searchq = encodeURI(searchq)
    console.log(searchq)
    var state = document.querySelector(".state").value
    console.log(state)
    var apikey = document.querySelector(".apikey").value

    var api_url = "https://api.propublica.org/congress/v1/members/house/"+state+"/current.json"
     
    var search_url = "https://twitter.com/search?f=live&q="+searchq+"+"


    // Empty arrays for processing API data
    let mapdata = {}
 
   fetch(api_url, {
  mode: 'cors',
  headers: {
     'X-API-Key': apikey
  }})
   .then(function(response){
        return response.json()
   })
    .then (function(res){
      mapdata=res
   console.log(mapdata)
   console.log(mapdata.results)
   var looplimit = mapdata.results.length  
   console.log(looplimit)
   var loopstart = 0
   let Rpols = []
   let Dpols = []
   let Bpols = []
   let twitterhandles = []

while (loopstart < looplimit) {

var polname = mapdata.results[loopstart].twitter_id
polname = "from:"+polname
polname = encodeURI(polname)
console.log(polname) 
var polparty = mapdata.results[loopstart].party
console.log(polparty)
Bpols.push(polname)
var twitter = mapdata.results[loopstart].twitter_id
console.log(twitter)
twitterhandles.push(twitter)

// Push to the specific party array 

if (polparty=="D") {
  Dpols.push(polname)
} else {
  Rpols.push(polname)
}



loopstart++

}

//Both Pols List

const Bitems = Bpols 

const n = 25 

const result = new Array(Math.ceil(Bitems.length / n))
  .fill()
  .map(_ => Bitems.splice(0, n))
  resultlength = result.length
  console.log(resultlength)
  resultstart = 0
var Bdiv = document.getElementById("Bpol")
Bdiv.innerHTML = "<h4>News search for representatives from both parties:</h4>"  
while (resultstart < resultlength) {
var BitemsString = result[resultstart]
var BitemsURL = BitemsString.join("%20OR%20")
var BitemsURL = "("+BitemsURL+")"
var resultsm = resultstart+1
var BitemsQ = search_url+BitemsURL
var BitemsQCount = "Google News - Congressional Rep Group"+resultsm+"  (click to open or right-click to open in new tab) <br>"
var BitemsQ = BitemsQCount.link(BitemsQ)
console.log(BitemsQ)

Bdiv.innerHTML = Bdiv.innerHTML + BitemsQ + "<br><br>"

resultstart++
}


//Dem Pols List

const Ditems = Dpols 

const o = 25 

const dresult = new Array(Math.ceil(Ditems.length / o))
  .fill()
  .map(_ => Ditems.splice(0, o))
  dresultlength = dresult.length
  console.log(dresultlength)
  resultstart = 0
  
while (resultstart < dresultlength) {
var ditemsString = dresult[resultstart]
var ditemsURL = ditemsString.join("%20OR%20")
console.log(ditemsURL)
var ditemsURL = "("+ditemsURL+")"
var ditemsQ = search_url+ditemsURL
console.log(ditemsQ)
resultstart++
}


//Rep Pols List

const ritems = Rpols 

const p = 25 

const rresult = new Array(Math.ceil(ritems.length / o))
  .fill()
  .map(_ => ritems.splice(0, o))
  rresultlength = rresult.length
  console.log(rresultlength)
  resultstart = 0
  
while (resultstart < rresultlength) {
var ritemsString = rresult[resultstart]
var ritemsURL = ritemsString.join("%20OR%20")
console.log(ritemsURL)
var ritemsURL = "("+ritemsURL+")"
var ritemsQ = search_url+ritemsURL
console.log(ritemsQ)
resultstart++
}


})



    
    }
</script>
  
  
  
</body>
</html>
